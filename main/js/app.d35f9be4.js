(function(e){function t(t){for(var i,a,o=t[0],c=t[1],l=t[2],m=0,d=[];m<o.length;m++)a=o[m],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(d.length)d.shift()();return n.push.apply(n,l||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,o=1;o<s.length;o++){var c=s[o];0!==r[c]&&(i=!1)}i&&(n.splice(t--,1),e=a(a.s=s[0]))}return e}var i={},r={app:0},n=[];function a(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=i,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"023c":function(e,t,s){},"034f":function(e,t,s){"use strict";s("85ec")},"04a9":function(e,t,s){},1314:function(e,t,s){"use strict";s("b2bc")},2118:function(e,t,s){"use strict";s("8b2b")},"217f":function(e,t,s){"use strict";s("703d")},2480:function(e,t,s){"use strict";s("ef9e")},2609:function(e,t,s){},"2c35":function(e,t,s){"use strict";s("e689")},3698:function(e,t,s){},4935:function(e,t,s){"use strict";s("04a9")},"56d7":function(e,t,s){"use strict";s.r(t);var i=s("2b0e"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("meta",{attrs:{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"}}),s("router-view")],1)},n=[],a={name:"App"},o=a,c=(s("034f"),s("2877")),l=Object(c["a"])(o,r,n,!1,null,null,null),u=l.exports,m=s("8c4f"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"view home"},[s("div",{staticClass:"center"},[s("b",[e._v(e._s(e.$i18n("welcome")))]),s("router-link",{staticClass:"create-story",attrs:{to:"/story"}},[e._v(e._s(e.$i18n("btn-create")))])],1)])},p=[],f={name:"Home"},h=f,g=(s("cccb"),Object(c["a"])(h,d,p,!1,null,null,null)),b=g.exports,v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"view story"},[s("CurrentFrame"),s("Frames"),s("SearchToolbar")],1)},y=[],_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"current-frame",style:e.currentFrame.style},[e.currentFrame.text?s("p",{domProps:{innerHTML:e._s(e.currentFrame.text)}}):e._e()])},S=[],w=s("2f62"),x={name:"CurrentFrame",computed:Object(w["c"])(["currentFrame"])},C=x,k=(s("2c35"),Object(c["a"])(C,_,S,!1,null,null,null)),I=k.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"frames"},[e._l(e.thumbnails,(function(t){return s("div",{key:t.id,staticClass:"frame",class:{"selected-frame":t.selected},style:t.style,on:{click:function(s){return e.selectFrame(t.id)}}})})),s("div",{staticClass:"frame btn-add-frame",on:{click:e.addFrame}},[e._v("+")])],2)},j=[],O={name:"Frames",computed:Object(w["c"])(["thumbnails"]),methods:Object(w["b"])(["selectFrame","addFrame"])},F=O,$=(s("2480"),Object(c["a"])(F,T,j,!1,null,null,null)),q=$.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-toolbar"},[s("router-link",{staticClass:"commons logo",attrs:{to:"/searchcommons"}},[e._v(e._s(e.$i18n("wikimedia-commons")))]),s("router-link",{staticClass:"wikipedia logo",attrs:{to:"/searchwikipedia"}},[e._v(e._s(e.$i18n("wikipedia")))])],1)},L=[],E={name:"SearchToolbar"},B=E,N=(s("2118"),Object(c["a"])(B,A,L,!1,null,"940a5c32",null)),P=N.exports,D={name:"Story",components:{CurrentFrame:I,Frames:q,SearchToolbar:P}},M=D,R=(s("217f"),Object(c["a"])(M,v,y,!1,null,null,null)),W=R.exports,H=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"view search-wp"},[i("Navigator",{attrs:{onBack:function(){return e.$router.push({name:"Story"})}}}),i("SearchForm",{attrs:{label:t.$i18n("search-box"),placeholder:t.$i18n("search-box"),query:t.query,loading:t.loading,onInput:t.onInput,onClear:t.onClear}}),i("ListView",{attrs:{items:t.results}})],1)},V=[],U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"listview"},e._l(e.items,(function(t){return s("div",{key:t.title,staticClass:"item"},[s("router-link",{attrs:{to:t.goto}},[s("div",{staticClass:"img",style:{backgroundImage:"url("+t.thumb+")"}}),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[e._v(e._s(t.title))]),s("div",{staticClass:"description"},[e._v(e._s(t.desc))])])])],1)})),0)},Q=[],z={name:"ListView",props:["items"]},J=z,G=(s("6675"),Object(c["a"])(J,U,Q,!1,null,"7d4bd75e",null)),X=G.exports,K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",{on:{submit:function(t){return e.onSubmit(t)}}},[s("div",{staticClass:"label"},[e._v(e._s(e.label))]),s("input",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"query",attrs:{type:"text",placeholder:e.placeholder},domProps:{value:e.query},on:{input:e.onInput}}),s("div",{staticClass:"icon"}),e.query?s("div",{staticClass:"close",on:{click:e.onClear}}):e._e(),e.loading?s("div",{staticClass:"loading-bar"}):e._e()])},Y=[],Z={name:"SearchForm",props:["label","placeholder","query","loading","onInput","onClear"],methods:{onSubmit:e=>e.preventDefault}},ee=Z,te=(s("1314"),Object(c["a"])(ee,K,Y,!1,null,"125a2cf9",null)),se=te.exports,ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"navigator"},[e.onBack?s("div",{staticClass:"back",on:{click:e.onBack}}):e._e(),e.onNext?s("div",{staticClass:"next",on:{click:e.onNext}}):e._e(),e.info?s("span",{staticClass:"info"},[e._v(e._s(e.info))]):e._e()])},re=[],ne={name:"Navigator",props:["onBack","onNext","info"]},ae=ne,oe=(s("6d78"),Object(c["a"])(ae,ie,re,!1,null,"4b967167",null)),ce=oe.exports,le={name:"SearchWikipedia",components:{ListView:X,SearchForm:se,Navigator:ce},methods:{...Object(w["b"])("search",["search","clear"]),onInput:function(e){e.preventDefault(),this.search(e.target.value)},onClear:function(e){e.preventDefault(),this.clear()}},computed:Object(w["c"])("search",["loading","results","query"])},ue=le,me=(s("884e"),Object(c["a"])(ue,H,V,!1,null,null,null)),de=me.exports,pe=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"view search-cm"},[i("Navigator",{attrs:{onBack:function(){return e.$router.push({name:"Story"})},onNext:t.selection.length&&t.editStory,info:t.selection.length&&t.$i18n("search-media-info",t.selection.length)}}),i("SearchForm",{attrs:{label:t.$i18n("search-media"),placeholder:t.$i18n("search-media"),query:t.query,loading:t.loading,onInput:t.onInput,onClear:t.onClear}}),i("ImageListView",{attrs:{items:t.results,onItemSelect:t.onItemSelect,selected:t.selection}})],1)},fe=[],he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"imagelistview"},[s("div",{staticClass:"imagelistview__list-wrapper"},[s("div",{staticClass:"imagelistview__list"},e._l(e.items,(function(t){return s("div",{key:t.id,staticClass:"imagelistview__list-image",style:{width:t.width+"px"},attrs:{"data-id":t.id},on:{click:e.onSelect}},[s("img",{attrs:{src:t.thumb,alt:t.title,loading:"lazy"}}),s("div",{class:{checkbox:!0,selected:e.selected.includes(t.id)}})])})),0)])])},ge=[],be={name:"ImageListView",props:["items","onItemSelect","selected"],methods:{onSelect(e){const t=e.target.getAttribute("data-id");this.selected.includes(t)?this.selected.splice(this.selected.indexOf(t),1):this.selected.push(t),this.onItemSelect(this.selected)}}},ve=be,ye=(s("609d"),Object(c["a"])(ve,he,ge,!1,null,"9157c556",null)),_e=ye.exports,Se={name:"SearchWikipedia",components:{ImageListView:_e,SearchForm:se,Navigator:ce},methods:{...Object(w["b"])("commons",["select","search","clear"]),...Object(w["b"])(["resetFrame"]),onInput:function(e){e.preventDefault(),this.search(e.target.value)},onClear:function(e){e.preventDefault(),this.clear()},onItemSelect:function(e){this.select(e)},editStory:function(){const e=this.selection.map((e,t)=>{const s=this.results.find(t=>t.id===e);return{id:t+1,img:s.thumb,text:s.desc}});this.resetFrame(e),this.$router.push({name:"Story"})}},computed:Object(w["c"])("commons",["selection","loading","results","query"])},we=Se,xe=(s("f207"),Object(c["a"])(we,pe,fe,!1,null,null,null)),Ce=xe.exports,ke=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"view"},[s("Back"),s("div",{staticClass:"article",domProps:{innerHTML:e._s(e.currentArticle)},on:{mouseup:e.onAfterSelect,touchend:e.onAfterSelect}}),s("div",{staticClass:"toolbar",style:e.selectionToolbarStyle},[s("div",{on:{click:e.onUseText}},[e._v("Highlight")]),s("div",{on:{click:e.onDismiss}},[e._v("Clear")])]),e.showImages?s("div",{staticClass:"article-overlay"}):e._e(),e.showImages?s("ArticleImages",{staticClass:"images",attrs:{images:e.articleImages,onSubmit:e.onUseImage}}):e._e()],1)},Ie=[],Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"back",on:{click:function(t){return e.$router.go(-1)}}})},je=[],Oe={name:"Back"},Fe=Oe,$e=(s("b37b"),Object(c["a"])(Fe,Te,je,!1,null,null,null)),qe=$e.exports,Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"article-images"},[s("div",{staticClass:"article-images-header"},[s("span",[e._v("Select an image")]),e.selectedImage?s("a",{on:{click:function(t){return e.onSubmit(e.selectedImage)}}},[e._v("Next")]):e._e()]),s("div",{staticClass:"article-images-thumbs"},e._l(e.images,(function(t){return s("img",{key:t.src,staticClass:"article-image-thumb",class:{selected:e.selectedImage===t.src},attrs:{src:t.src},on:{click:function(s){return e.selectImage(t.src)}}})})),0)])},Le=[],Ee={name:"ArticleImages",props:["images","onSubmit"],data:()=>({selectedImage:null}),methods:{selectImage:function(e){this.selectedImage=e}}},Be=Ee,Ne=(s("c452"),Object(c["a"])(Be,Ae,Le,!1,null,null,null)),Pe=Ne.exports,De={name:"Article",props:["article"],components:{Back:qe,ArticleImages:Pe},data:()=>({selectionToolbarStyle:{display:"none",position:"absolute"},selectedText:null,showImages:!1,images:[]}),computed:{...Object(w["c"])(["currentArticle"]),articleImages:()=>Array.from(document.querySelector(".article").querySelectorAll("img")).map(e=>({src:e.src}))},methods:{...Object(w["b"])(["fetchArticle","setText","setImg"]),showSelectionToolbar:function(e){this.selectionToolbarStyle.display="flex",this.selectionToolbarStyle.top=e.top-43+"px",this.selectionToolbarStyle.left=e.left+"px"},hideSelectionToolbar:function(){this.selectionToolbarStyle.display="none"},onAfterSelect:function(e){e.preventDefault();const t=document.getSelection(),s=t&&t.getRangeAt(0);s&&!s.collapsed?(this.selectedText=t.toString(),this.showSelectionToolbar(s.getBoundingClientRect())):this.hideSelectionToolbar()},onUseText:function(){this.hideSelectionToolbar(),this.showImages=!0},onUseImage:function(e){this.setText(this.selectedText),this.setImg(e),this.$router.push({name:"Story"})},onDismiss:function(){this.hideSelectionToolbar()}},created:function(){this.fetchArticle(this.article)}},Me=De,Re=(s("4935"),Object(c["a"])(Me,ke,Ie,!1,null,null,null)),We=Re.exports;i["a"].use(m["a"]);const He=[{path:"/",name:"Home",component:b},{path:"/story",name:"Story",component:W},{path:"/searchwikipedia",name:"SearchWikipedia",component:de},{path:"/searchcommons",name:"SearchCommons",component:Ce},{path:"/article/:article",name:"Article",component:We,props:!0}],Ve=new m["a"]({routes:He});var Ue=Ve;const Qe=5,ze=e=>e.img?{backgroundImage:"url("+e.img+")",backgroundPosition:"center",backgroundSize:"cover"}:{background:"linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%)"};var Je={state:{currentFrameId:1,frames:[{id:1,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/Bandhavgarh_Tigers.jpg/640px-Bandhavgarh_Tigers.jpg",text:"Bandhavgarh Tigers"},{id:2,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/White_Tiger_in_Touroparc.jpg/640px-White_Tiger_in_Touroparc.jpg",text:"White Tiger in Touroparc"},{id:3,img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/TigerVector.png/640px-TigerVector.png",text:"Taken from the Coat of arms of Vladivostok and modified."}]},mutations:{selectFrame:(e,t)=>e.currentFrameId=t,addFrame:e=>{if(e.frames.length===Qe)return;const t=e.frames.length+1;e.frames.push({text:"",img:"",id:t}),e.currentFrameId=t},resetFrame:(e,t)=>{e.currentFrameId=t.length,e.frames=t},setText:(e,t)=>{const s=e.frames.find(t=>t.id===e.currentFrameId);s.text=t},setImg:(e,t)=>{const s=e.frames.find(t=>t.id===e.currentFrameId);s.img=t}},actions:{selectFrame:({commit:e},t)=>{e("selectFrame",t)},addFrame:({commit:e})=>{e("addFrame")},resetFrame:({commit:e},t)=>{e("resetFrame",t)},setText:({commit:e},t)=>{e("setText",t)},setImg:({commit:e},t)=>{e("setImg",t)}},getters:{thumbnails:e=>e.frames.map(t=>{const s={...t};return t.id===e.currentFrameId&&(s.selected=!0),s.style=ze(t),s}),currentFrame:e=>{const t=e.frames.find(t=>t.id===e.currentFrameId);return{text:t.text,style:ze(t),noImage:""===t.img}}}};let Ge=[];const Xe=()=>{Ge.forEach(e=>e&&e.abort()),Ge=[]},Ke=(e,t)=>{Xe();const s=new XMLHttpRequest;s.open("GET",e),s.send(),s.addEventListener("load",()=>{t(JSON.parse(s.responseText))}),s.addEventListener("error",()=>{t(null,s.status)}),Ge.push(s)};var Ye={namespaced:!0,state:{loading:!1,results:[],query:""},mutations:{setLoading:(e,t)=>e.loading=t,setQuery:(e,t)=>e.query=t,setResults:(e,t)=>e.results=t},actions:{search:({commit:e},t)=>{const s=t.trim(),i=`https://en.wikipedia.org/w/rest.php/v1/search/title?q=${s}&limit=10`;if(e("setQuery",t),!s)return Xe(),e("setLoading",!1),void e("setResults",[]);e("setLoading",!0),Ke(i,t=>{t.pages&&e("setResults",Object.values(t.pages).map(e=>({title:e.title,desc:e.description,thumb:e.thumbnail&&e.thumbnail.url,goto:{name:"Article",params:{article:e.title}}}))),e("setLoading",!1)})},clear:({commit:e})=>{Xe(),e("setLoading",!1),e("setResults",[]),e("setQuery","")}},getters:{loading:e=>e.loading,results:e=>e.results,query:e=>e.query}},Ze={namespaced:!0,state:{selection:[],loading:!1,results:[],query:""},mutations:{setSelection:(e,t)=>e.selection=t,setLoading:(e,t)=>e.loading=t,setQuery:(e,t)=>e.query=t,setResults:(e,t)=>e.results=t},actions:{search:({commit:e},t)=>{const s=t.trim(),i=`https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&uselang=en&generator=search&gsrsearch=filetype%3Abitmap%7Cdrawing%20${s}&gsrlimit=40&gsroffset=0&gsrinfo=totalhits%7Csuggestion&gsrprop=snippet&prop=imageinfo&gsrnamespace=6&iiprop=url%7Cextmetadata&iiurlheight=180&iiextmetadatafilter=License%7CLicenseShortName%7CImageDescription%7CArtist`;if(e("setQuery",t),!s)return Xe(),e("setSelection",[]),e("setLoading",!1),void e("setResults",[]);e("setLoading",!0),Ke(i,t=>{if(t.query&&t.query.pages){const s=Object.values(t.query.pages).sort((e,t)=>e.index-t.index);e("setResults",s.map(e=>{const t=e.imageinfo[0],s=t.responsiveUrls&&Object.values(t.responsiveUrls)[0],i=t.extmetadata,r=i&&i.ImageDescription&&i.ImageDescription.value;return{id:e.pageid.toString(),title:e.title,desc:r||e.snippet,thumb:s||t.url,width:t.thumbwidth}}))}e("setSelection",[]),e("setLoading",!1)})},clear:({commit:e})=>{Xe(),e("setSelection",[]),e("setLoading",!1),e("setResults",[]),e("setQuery","")},select:({commit:e},t)=>{e("setSelection",t)}},getters:{selection:e=>e.selection,loading:e=>e.loading,results:e=>e.results,query:e=>e.query}};const et={"put styles in body":e=>{for(const t of e.head.querySelectorAll('link[rel="stylesheet"]'))e.body.prepend(t)},"remove stuff":e=>{const t=["table",".pcs-collapse-table-container","script"];for(const s of e.querySelectorAll(t.join(",")))s.remove()},"unhide sections":e=>{for(const t of e.querySelectorAll("section"))t.style.display="block"},"remove links":e=>{let t;for(const s of e.querySelectorAll("a"))t=e.createElement("span"),t.innerHTML=s.innerHTML,s.replaceWith(t)},"load images":e=>{for(const t of e.querySelectorAll("figure")){let s=t.querySelector("span[data-src]");if(s){let i=e.createElement("img");i.src=s.getAttribute("data-src"),i.classList.add("pcs-widen-image-override"),i.classList.add("pcs-lazy-load-image-loaded"),t.replaceChildren(i)}else t.remove()}}};var tt={state:{article:{title:"",html:""}},mutations:{setArticle:({article:e},{title:t,html:s})=>{e.title=t,e.html=s}},actions:{fetchArticle:async({commit:e},t)=>{const s="https://en.wikipedia.org/api/rest_v1/page/mobile-html/"+t,i=await(await fetch(s)).text(),r=(new DOMParser).parseFromString(i,"text/html");Object.values(et).forEach(e=>e(r)),e("setArticle",{title:t,html:r.body.outerHTML})}},getters:{currentArticle:({article:e})=>e.html}};i["a"].use(w["a"]);var st=new w["a"].Store({modules:{story:Je,search:Ye,article:tt,commons:Ze}});i["a"].directive("focus",{inserted:function(e){e.focus()}});var it=s("5093"),rt=s.n(it),nt={welcome:"Welcome to Wikistories","btn-create":"Create a story","search-box":"Search Wikipedia","search-media":"Search Media","search-media-info":"$1 selected","wikimedia-commons":"Commons",wikipedia:"Wikipedia"},at={welcome:"Bienvenue sur les Wikistoires","btn-create":"Creer une histoire"};const ot=()=>new URL(location.href).searchParams.get("lang")||"en";i["a"].use(rt.a,{locale:ot(),messages:{en:nt,fr:at}}),i["a"].config.productionTip=!1,new i["a"]({router:Ue,store:st,render:e=>e(u)}).$mount("#app")},"5ced":function(e,t,s){},"609d":function(e,t,s){"use strict";s("e47c")},6675:function(e,t,s){"use strict";s("023c")},"6d78":function(e,t,s){"use strict";s("2609")},"703d":function(e,t,s){},"7be0":function(e,t,s){},"85ec":function(e,t,s){},"884e":function(e,t,s){"use strict";s("ba7b")},"8b2b":function(e,t,s){},a8b7:function(e,t,s){},b2bc:function(e,t,s){},b37b:function(e,t,s){"use strict";s("3698")},ba7b:function(e,t,s){},c452:function(e,t,s){"use strict";s("a8b7")},cccb:function(e,t,s){"use strict";s("5ced")},e47c:function(e,t,s){},e689:function(e,t,s){},ef9e:function(e,t,s){},f207:function(e,t,s){"use strict";s("7be0")}});
//# sourceMappingURL=app.d35f9be4.js.map