(function(t){function e(e){for(var s,r,o=e[0],c=e[1],l=e[2],m=0,d=[];m<o.length;m++)r=o[m],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);u&&u(e);while(d.length)d.shift()();return n.push.apply(n,l||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,o=1;o<i.length;o++){var c=i[o];0!==a[c]&&(s=!1)}s&&(n.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},a={app:0},n=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"023c":function(t,e,i){},"034f":function(t,e,i){"use strict";i("85ec")},"04a9":function(t,e,i){},"09e0":function(t,e,i){},1271:function(t,e,i){},"217f":function(t,e,i){"use strict";i("703d")},2480:function(t,e,i){"use strict";i("ef9e")},"29d4":function(t,e,i){"use strict";i("2f620")},"2f620":function(t,e,i){},"2f7e":function(t,e,i){},"3a9f":function(t,e,i){},4935:function(t,e,i){"use strict";i("04a9")},"56d7":function(t,e,i){"use strict";i.r(e);var s=i("2b0e"),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},n=[],r={name:"App",methods:{setStylePropertyVh(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",t+"px")}},mounted(){this.setStylePropertyVh(),window.addEventListener("resize",this.setStylePropertyVh)},beforeUnmount(){window.removeEventListener("resize",this.setStylePropertyVh)}},o=r,c=(i("034f"),i("2877")),l=Object(c["a"])(o,a,n,!1,null,null,null),u=l.exports,m=i("8c4f"),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view home"},[i("div",{staticClass:"center"},[i("b",[t._v(t._s(t.$i18n("welcome")))]),i("router-link",{staticClass:"create-story",attrs:{to:"/story"}},[t._v(t._s(t.$i18n("btn-create")))])],1)])},h=[],p={name:"Home"},f=p,b=(i("cccb"),Object(c["a"])(f,d,h,!1,null,null,null)),g=b.exports,v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view story"},[t.canPublish?i("PrimaryButton",{staticClass:"publish-button",attrs:{text:t.$i18n("btn-next"),onClick:t.onPublish}}):t._e(),i("CurrentFrame"),i("Frames"),i("SearchToolbar")],1)},y=[],C=i("2f62"),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"current-frame",style:t.currentFrame.style},[t.currentFrame.text?i("p",{domProps:{innerHTML:t._s(t.currentFrame.text)}}):t._e(),i("ImageAttribution")],1)},w=[],k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.attributionReady?i("div",{staticClass:"image-attribution"},[i("div",{staticClass:"image-attribution-info"},[t._l(t.presentLicenses,(function(t){return i("div",{key:t,class:"image-attribution-info-"+t.toLowerCase()})})),i("bdi",{staticClass:"image-attribution-info-author",domProps:{innerHTML:t._s(t.currentFrame.imgAttribution.author||t.$i18n("unknown-author"))}})],2),i("div",{staticClass:"image-attribution-more-info"},[i("a",{staticClass:"image-attribution-more-info-link",attrs:{href:t.currentFrame.imgAttribution.url,target:"_blank"}})])]):t._e()},x=[],S={name:"ImageAttribution",data:()=>({licenseTypes:["CC","BY","SA","Fair","Public"]}),computed:{...Object(C["c"])(["currentFrame"]),presentLicenses:function(){return this.licenseTypes.filter(t=>-1!==this.currentFrame.imgAttribution.license.indexOf(t))},attributionReady:function(){return this.currentFrame.imgAttribution}}},I=S,F=(i("9c37"),Object(c["a"])(I,k,x,!1,null,"4c8f6900",null)),$=F.exports,T={name:"CurrentFrame",components:{ImageAttribution:$},computed:Object(C["c"])(["currentFrame"])},L=T,O=(i("a2f2"),Object(c["a"])(L,_,w,!1,null,"667bdeb8",null)),A=O.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"frames"},[t._l(t.thumbnails,(function(e){return i("div",{key:e.id,staticClass:"frame",class:{"selected-frame":e.selected},style:e.style,on:{click:function(i){return t.selectFrame(e.id)}}})})),i("div",{staticClass:"frame btn-add-frame",on:{click:t.addFrame}},[t._v("+")])],2)},P=[],D={name:"Frames",computed:Object(C["c"])(["thumbnails"]),methods:Object(C["b"])(["selectFrame","addFrame"])},E=D,q=(i("2480"),Object(c["a"])(E,j,P,!1,null,null,null)),W=q.exports,N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"search-toolbar"},[i("router-link",{staticClass:"commons logo",attrs:{to:"/searchcommons"}},[t._v(t._s(t.$i18n("wikimedia-commons")))]),i("div",{staticClass:"border"}),i("router-link",{staticClass:"wikipedia logo",attrs:{to:"/searchwikipedia"}},[t._v(t._s(t.$i18n("wikipedia")))])],1)},B=[],M={name:"SearchToolbar"},R=M,H=(i("29d4"),Object(c["a"])(R,N,B,!1,null,"d23ff7cc",null)),U=H.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"primary-button",attrs:{name:"button"},on:{click:t.onClick}},[t._v(t._s(t.text))])},z=[],Q={name:"PrimaryButton",props:["text","onClick"]},J=Q,G=(i("9131"),Object(c["a"])(J,V,z,!1,null,"fa2cd3ac",null)),X=G.exports,Y={name:"Story",components:{CurrentFrame:A,Frames:W,SearchToolbar:U,PrimaryButton:X},methods:{...Object(C["b"])(["setCreationDate","fetchImgAttribution"]),onPublish:function(){this.setCreationDate(),this.$router.push({name:"Publish"})}},computed:{...Object(C["c"])(["currentFrame","storyLength","valid","attributionData"]),canPublish:function(){return this.valid&&this.currentFrame.id===this.storyLength}},mounted:function(){const t=this.attributionData.find(t=>""!==t.title&&!t.attribution);t&&this.fetchImgAttribution({id:t.id,title:t.title})}},K=Y,Z=(i("217f"),i("a51b"),Object(c["a"])(K,v,y,!1,null,"358dc198",null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"viewer",style:t.currentFrame.style},[i("div",{staticClass:"progress-container"},t._l(t.storyLength,(function(e){return i("div",{key:e,staticClass:"progress"},[t.currentFrame.id===e?i("div",{staticClass:"loading"}):t.currentFrame.id>e?i("div",{staticClass:"loaded"}):t._e()])})),0),t.currentFrame.text?i("div",{staticClass:"story-text",domProps:{innerHTML:t._s(t.currentFrame.text)}}):t._e(),i("ImageAttribution"),t.storyEnd?i("div",{staticClass:"restart-btn",on:{click:t.restartStory}},[t._v(t._s(t.$i18n("btn-restart-story")))]):t._e()],1)},it=[],st={name:"StoryViewer",data:()=>({frameDuration:2e3,storyEnd:!1}),components:{ImageAttribution:$},computed:Object(C["c"])(["currentFrame","storyLength"]),methods:{...Object(C["b"])(["selectFrame"]),playNextFrame:function(){const t=setTimeout(()=>{this.selectFrame(this.currentFrame.id+1),clearTimeout(t)},this.frameDuration)},restartStory:function(){this.storyEnd=!1,this.selectFrame(1)},endStory:function(){const t=setTimeout(()=>{this.storyEnd=!0,clearTimeout(t)},this.frameDuration)}},beforeMount:function(){this.currentFrame.id>1&&this.restartStory()},mounted:function(){this.currentFrame.id<this.storyLength&&this.playNextFrame()},updated:function(){this.currentFrame.id<this.storyLength?this.playNextFrame():this.storyEnd||this.endStory()}},at=st,nt=(i("7089"),Object(c["a"])(at,et,it,!1,null,"ac8f0236",null)),rt=nt.exports,ot=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"view search-wp"},[s("Navigator",{attrs:{onBack:function(){return t.$router.push({name:"Story"})}}}),s("SearchForm",{attrs:{label:e.$i18n("search-box"),placeholder:e.$i18n("search-box"),query:e.query,loading:e.loading,onInput:e.onInput,onClear:e.onClear}}),s("ListView",{attrs:{items:e.results}})],1)},ct=[],lt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"listview"},t._l(t.items,(function(e){return i("div",{key:e.title,staticClass:"item"},[i("router-link",{attrs:{to:e.goto}},[i("div",{staticClass:"img",style:{backgroundImage:"url("+e.thumb+")"}}),i("div",{staticClass:"info"},[i("div",{staticClass:"title"},[t._v(t._s(e.title))]),i("div",{staticClass:"description"},[t._v(t._s(e.desc))])])])],1)})),0)},ut=[],mt={name:"ListView",props:["items"]},dt=mt,ht=(i("6675"),Object(c["a"])(dt,lt,ut,!1,null,"7d4bd75e",null)),pt=ht.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{on:{submit:function(e){return t.onSubmit(e)}}},[i("div",{staticClass:"label"},[t._v(t._s(t.label))]),i("input",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"query",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.query},on:{input:t.onInput}}),i("div",{staticClass:"icon"}),t.query?i("div",{staticClass:"close",on:{click:t.onClear}}):t._e(),t.loading?i("div",{staticClass:"loading-bar"}):t._e()])},bt=[],gt={name:"SearchForm",props:["label","placeholder","query","loading","onInput","onClear"],methods:{onSubmit:t=>t.preventDefault}},vt=gt,yt=(i("e15c"),Object(c["a"])(vt,ft,bt,!1,null,"0d3ec56b",null)),Ct=yt.exports,_t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"navigator"},[t.onBack?i("div",{staticClass:"back",on:{click:t.onBack}}):t._e(),t.onNext?i("div",{staticClass:"next",on:{click:t.onNext}},[t._v(t._s(t.$i18n("btn-next")))]):t._e(),t.info?i("span",{staticClass:"info"},[t._v(t._s(t.info))]):t._e()])},wt=[],kt={name:"Navigator",props:["onBack","onNext","info"]},xt=kt,St=(i("62fb"),Object(c["a"])(xt,_t,wt,!1,null,"1cd70b57",null)),It=St.exports,Ft={name:"SearchWikipedia",components:{ListView:pt,SearchForm:Ct,Navigator:It},methods:{...Object(C["b"])("search",["search","clear"]),onInput:function(t){t.preventDefault(),this.search(t.target.value)},onClear:function(t){t.preventDefault(),this.clear()}},computed:Object(C["c"])("search",["loading","results","query"])},$t=Ft,Tt=(i("884e"),Object(c["a"])($t,ot,ct,!1,null,null,null)),Lt=Tt.exports,Ot=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"view search-cm"},[s("Navigator",{attrs:{onBack:function(){return t.$router.push({name:"Story"})},onNext:e.selection.length&&e.editStory,info:e.selection.length&&e.$i18n("search-media-info",e.selection.length)}}),s("SearchForm",{attrs:{label:e.$i18n("search-media"),placeholder:e.$i18n("search-media"),query:e.query,loading:e.loading,onInput:e.onInput,onClear:e.onClear}}),s("ImageListView",{attrs:{items:e.results,onItemSelect:e.onItemSelect,selected:e.selection}})],1)},At=[],jt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"imagelistview"},[i("div",{staticClass:"imagelistview__list-wrapper"},[i("div",{staticClass:"imagelistview__list"},t._l(t.items,(function(e){return i("div",{key:e.id,staticClass:"imagelistview__list-image",style:{width:e.width+"px"},attrs:{"data-id":e.id},on:{click:t.onSelect}},[i("img",{attrs:{src:e.thumb,alt:e.title,loading:"lazy"}}),i("div",{class:{checkbox:!0,selected:t.selected.includes(e.id)}})])})),0)])])},Pt=[],Dt={name:"ImageListView",props:["items","onItemSelect","selected"],methods:{onSelect(t){const e=t.target.getAttribute("data-id")||t.target.parentElement.getAttribute("data-id");this.selected.includes(e)?this.selected.splice(this.selected.indexOf(e),1):this.selected.push(e),this.onItemSelect(this.selected)}}},Et=Dt,qt=(i("b78b"),Object(c["a"])(Et,jt,Pt,!1,null,"0bcf1f81",null)),Wt=qt.exports,Nt={name:"SearchWikipedia",components:{ImageListView:Wt,SearchForm:Ct,Navigator:It},methods:{...Object(C["b"])("commons",["select","search","clear"]),...Object(C["b"])(["resetFrame"]),onInput:function(t){t.preventDefault(),this.search(t.target.value)},onClear:function(t){t.preventDefault(),this.clear()},onItemSelect:function(t){this.select(t)},editStory:function(){const t=this.selection.map((t,e)=>{const i=this.results.find(e=>e.id===t);return{id:e+1,img:i.thumb,text:i.desc,imgTitle:i.title,attribution:i.attribution}});this.resetFrame(t),this.$router.push({name:"Story"})}},computed:Object(C["c"])("commons",["selection","loading","results","query"])},Bt=Nt,Mt=(i("f207"),Object(c["a"])(Bt,Ot,At,!1,null,null,null)),Rt=Mt.exports,Ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view"},[i("Back"),i("div",{staticClass:"article",domProps:{innerHTML:t._s(t.currentArticle.html)}}),i("div",{staticClass:"toolbar",style:t.selectionToolbarStyle},[i("div",{on:{touchstart:t.onUseText,mousedown:t.onUseText}},[t._v(t._s(t.$i18n("btn-highlight")))]),i("div",{on:{click:t.onDismiss}},[t._v(t._s(t.$i18n("btn-clear")))])]),t.showImages?i("div",{staticClass:"article-overlay",on:{click:t.dismissImages}}):t._e(),t.showImages?i("ArticleImages",{staticClass:"images",attrs:{images:t.articleImages,onSubmit:t.onUseImage}}):t._e()],1)},Ut=[],Vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"back",on:{click:function(e){return t.$router.go(-1)}}})},zt=[],Qt={name:"Back"},Jt=Qt,Gt=(i("8637"),Object(c["a"])(Jt,Vt,zt,!1,null,"9a398128",null)),Xt=Gt.exports,Yt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"article-images"},[i("div",{staticClass:"article-images-header"},[i("span",[t._v(t._s(t.$i18n("btn-select-image")))]),t.selectedImage?i("a",{on:{click:function(e){return t.onSubmit(t.selectedImage)}}},[t._v(t._s(t.$i18n("btn-next")))]):t._e()]),i("div",{staticClass:"article-images-thumbs"},t._l(t.images,(function(e){return i("img",{key:e.id,staticClass:"article-image-thumb",class:{selected:t.selectedImage===e},attrs:{src:e.src},on:{click:function(i){return t.selectImage(e)}}})})),0)])},Kt=[],Zt={name:"ArticleImages",props:["images","onSubmit"],data:()=>({selectedImage:null}),methods:{selectImage:function(t){this.selectedImage=t}}},te=Zt,ee=(i("c452"),Object(c["a"])(te,Yt,Kt,!1,null,null,null)),ie=ee.exports,se={name:"Article",props:["article"],components:{Back:Xt,ArticleImages:ie},data:()=>({selectionToolbarStyle:{display:"none",position:"absolute"},selectedText:null,showImages:!1,images:[]}),computed:{...Object(C["c"])(["currentArticle"]),articleImages:function(){return this.currentArticle.media.map((t,e)=>({src:t.srcset[0].src,id:e}))}},methods:{...Object(C["b"])(["fetchArticle","fetchArticleMedia","setText","setImg","setImgTitle"]),setToolbarDisplay:function(t){this.selectionToolbarStyle.display!==t&&(this.selectionToolbarStyle.display=t)},showSelectionToolbar:function(){this.setToolbarDisplay("flex")},hideSelectionToolbar:function(){this.setToolbarDisplay("none")},onSelectionChange:function(){const t=document.getSelection();t.isCollapsed?this.hideSelectionToolbar():(this.selectedText=t.toString(),this.showSelectionToolbar())},onUseText:function(t){t.preventDefault(),t.stopPropagation(),this.hideSelectionToolbar(),this.showImages=!0},onUseImage:function(t){const e=this.currentArticle.media[t.id].title;this.setImgTitle(e),this.setText(this.selectedText),this.setImg(t.src),this.$router.push({name:"Story"})},dismissImages:function(){this.showImages=!1},onDismiss:function(){this.hideSelectionToolbar()}},created:function(){this.fetchArticle(this.article),this.fetchArticleMedia(this.article)},mounted(){document.addEventListener("selectionchange",this.onSelectionChange)},beforeUnmount(){document.removeEventListener("selectionchange",this.onSelectionChange)}},ae=se,ne=(i("4935"),Object(c["a"])(ae,Ht,Ut,!1,null,null,null)),re=ne.exports,oe=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"view publish"},[s("Navigator",{attrs:{onBack:function(){return t.$router.push({name:"Story"})}}}),s("div",{staticClass:"header"},[s("h2",{staticClass:"title",domProps:{innerHTML:e._s(e.storyInfo.title)}}),s("div",{staticClass:"img-preview",style:e.imgSyle})]),s("div",{staticClass:"main"},[s("div",{staticClass:"item"},[s("label",{staticClass:"label"},[e._v(e._s(e.$i18n("publish-date")))]),s("p",{staticClass:"info"},[e._v(e._s(e._f("formatDate")(e.storyInfo.creationDate)))])]),s("div",{staticClass:"item"},[s("label",{staticClass:"tags"},[e._v(e._s(e.$i18n("publish-tags")))]),s("p",{staticClass:"info"},[e._v(e._s(e.$i18n("tags-not-set")))])]),s("div",{staticClass:"item"},[s("label",{staticClass:"Language"},[e._v(e._s(e.$i18n("publish-language")))]),s("p",{staticClass:"info"},[e._v("English")])])]),s("PrimaryButton",{staticClass:"confirm-publish",attrs:{text:e.$i18n("btn-publish-wikistory"),onClick:e.onPublish}})],1)},ce=[],le={name:"Publish",components:{Navigator:It,PrimaryButton:X},methods:{onPublish:function(){this.$router.push({name:"StoryViewer"})}},computed:{...Object(C["c"])(["thumbnails","storyInfo"]),imgSyle:function(){return this.thumbnails[0].style}}},ue=le,me=(i("d79a"),Object(c["a"])(ue,oe,ce,!1,null,"5b84f53a",null)),de=me.exports;s["a"].use(m["a"]);const he=[{path:"/",name:"Home",component:g},{path:"/story",name:"Story",component:tt},{path:"/searchwikipedia",name:"SearchWikipedia",component:Lt},{path:"/searchcommons",name:"SearchCommons",component:Rt},{path:"/article/:article",name:"Article",component:re,props:!0},{path:"/publish",name:"Publish",component:de},{path:"/viewer",name:"StoryViewer",component:rt}],pe=new m["a"]({routes:he});var fe=pe;const be=new URL(location.href).searchParams.get("lang")||"en",ge=be,ve=t=>{const e=(new window.DOMParser).parseFromString(t,"text/html");for(const i of e.querySelectorAll("span"))"none"===i.style.display&&i.remove();return e.body.textContent||""},ye=t=>t.replace(/https:\/\/(.*?)\./,t=>t+"m."),Ce=5,_e=t=>t.img?{backgroundImage:"url("+t.img+")",backgroundPosition:"center",backgroundSize:"cover"}:{background:"linear-gradient(338.27deg, #0BD564 -70.53%, #3366CC 71.84%)"};var we={state:{storyTitle:"",creationDate:null,currentFrameId:1,frames:[{id:1,img:null,text:"",imgTitle:"",attribution:null}]},mutations:{selectFrame:(t,e)=>t.currentFrameId=e,addFrame:t=>{if(t.frames.length===Ce)return;const e=t.frames.length+1;t.frames.push({text:"",img:"",imgTitle:"",id:e,attribution:null}),t.currentFrameId=e},resetFrame:(t,e)=>{t.currentFrameId=e.length,t.frames=e},setText:(t,e)=>{const i=t.frames.find(e=>e.id===t.currentFrameId);i.text=e},setImg:(t,e)=>{const i=t.frames.find(e=>e.id===t.currentFrameId);i.img=e},setImgTitle:(t,e)=>{const i=t.frames.find(e=>e.id===t.currentFrameId);i.imgTitle=e},setImgAttribution:(t,e)=>{const i=t.frames.find(t=>t.id===e.id);i.attribution=e},setCreationDate:(t,e)=>{t.creationDate=e}},actions:{selectFrame:({commit:t},e)=>{t("selectFrame",e)},addFrame:({commit:t})=>{t("addFrame")},resetFrame:({commit:t},e)=>{t("resetFrame",e)},setText:({commit:t},e)=>{t("setText",e)},setImg:({commit:t},e)=>{t("setImg",e)},setImgTitle:({commit:t},e)=>{t("setImgTitle",e)},fetchImgAttribution:async({commit:t},e)=>{const i=`https://${ge}.wikipedia.org/w/api.php?format=json&formatversion=2&origin=*&action=query&prop=imageinfo&iiextmetadatafilter=License%7CLicenseShortName%7CImageDescription%7CArtist&iiextmetadatalanguage=en&iiextmetadatamultilang=1&iiprop=url%7Cextmetadata&titles=${encodeURIComponent(e.title)}`,s=await(await fetch(i)).text(),a=JSON.parse(s),n=a.query.pages[0].imageinfo[0];if(n){const{Artist:i,LicenseShortName:s}=n.extmetadata,a={author:i?ve(i.value):"",url:ye(n.descriptionshorturl),license:s&&s.value,id:e.id};t("setImgAttribution",a)}},setCreationDate:({commit:t})=>{t("setCreationDate",(new Date).getTime())}},getters:{thumbnails:t=>t.frames.map(e=>{const i={...e};return e.id===t.currentFrameId&&(i.selected=!0),i.style=_e(e),i}),currentFrame:t=>{const e=t.frames.find(e=>e.id===t.currentFrameId);return{text:e.text,style:_e(e),noImage:""===e.img,id:t.currentFrameId,imgAttribution:e.attribution,imgTitle:e.imgTitle}},storyLength:t=>t.frames.length,storyInfo:t=>({title:t.frames[0].text,creationDate:t.creationDate}),valid:t=>t.frames.length>=2&&t.frames.every(t=>t.img&&t.text),attributionData:t=>t.frames.map(t=>({id:t.id,title:t.imgTitle,attribution:t.attribution}))}};let ke=[];const xe=()=>{ke.forEach(t=>t&&t.abort()),ke=[]},Se=(t,e)=>{xe();const i=new XMLHttpRequest;i.open("GET",t),i.send(),i.addEventListener("load",()=>{e(JSON.parse(i.responseText))}),i.addEventListener("error",()=>{e(null,i.status)}),ke.push(i)};var Ie={namespaced:!0,state:{loading:!1,results:[],query:""},mutations:{setLoading:(t,e)=>t.loading=e,setQuery:(t,e)=>t.query=e,setResults:(t,e)=>t.results=e},actions:{search:({commit:t},e)=>{const i=e.trim(),s=`https://${ge}.wikipedia.org/w/rest.php/v1/search/title?q=${i}&limit=10`;if(t("setQuery",e),!i)return xe(),t("setLoading",!1),void t("setResults",[]);t("setLoading",!0),Se(s,e=>{e.pages&&t("setResults",Object.values(e.pages).map(t=>({title:t.title,desc:t.description,thumb:t.thumbnail&&t.thumbnail.url,goto:{name:"Article",params:{article:t.title}}}))),t("setLoading",!1)})},clear:({commit:t})=>{xe(),t("setLoading",!1),t("setResults",[]),t("setQuery","")}},getters:{loading:t=>t.loading,results:t=>t.results,query:t=>t.query}},Fe={namespaced:!0,state:{selection:[],loading:!1,results:[],query:""},mutations:{setSelection:(t,e)=>t.selection=e,setLoading:(t,e)=>t.loading=e,setQuery:(t,e)=>t.query=e,setResults:(t,e)=>t.results=e},actions:{search:({commit:t},e)=>{const i=e.trim(),s=`https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&uselang=${be}&generator=search&gsrsearch=filetype%3Abitmap%7Cdrawing%20${i}&gsrlimit=40&gsroffset=0&gsrinfo=totalhits%7Csuggestion&gsrprop=snippet&prop=imageinfo&gsrnamespace=6&iiprop=url%7Cextmetadata&iiurlheight=180&iiextmetadatafilter=License%7CLicenseShortName%7CImageDescription%7CArtist&iiextmetadatalanguage=${be}`;if(t("setQuery",e),!i)return xe(),t("setSelection",[]),t("setLoading",!1),void t("setResults",[]);t("setLoading",!0),Se(s,e=>{if(e.query&&e.query.pages){const i=Object.values(e.query.pages).sort((t,e)=>t.index-e.index);t("setResults",i.map(t=>{const e=t.imageinfo[0],i=e.responsiveUrls&&Object.values(e.responsiveUrls)[0],s=e.extmetadata,a=s&&s.ImageDescription&&s.ImageDescription.value,{Artist:n,LicenseShortName:r}=e.extmetadata;return{id:t.pageid.toString(),title:t.title,desc:a||t.snippet,thumb:i||e.url,width:e.thumbwidth,attribution:{author:n?ve(n.value):"",url:ye(e.descriptionshorturl),license:r&&r.value}}}))}t("setSelection",[]),t("setLoading",!1)})},clear:({commit:t})=>{xe(),t("setSelection",[]),t("setLoading",!1),t("setResults",[]),t("setQuery","")},select:({commit:t},e)=>{t("setSelection",e)}},getters:{selection:t=>t.selection,loading:t=>t.loading,results:t=>t.results,query:t=>t.query}};const $e={"put styles in body":t=>{for(const e of t.head.querySelectorAll('link[rel="stylesheet"]'))t.body.prepend(e)},"remove stuff":t=>{const e=["table",".pcs-collapse-table-container","script"];for(const i of t.querySelectorAll(e.join(",")))i.remove()},"unhide sections":t=>{for(const e of t.querySelectorAll("section"))e.style.display="block"},"remove links":t=>{let e;for(const i of t.querySelectorAll("a"))e=t.createElement("span"),e.innerHTML=i.innerHTML,i.replaceWith(e)},"load images":t=>{for(const e of t.querySelectorAll("span[data-src]"))if(e){let i=t.createElement("img");i.src=e.getAttribute("data-src"),i.classList.add("pcs-widen-image-override"),i.classList.add("pcs-lazy-load-image-loaded"),e.replaceChildren(i)}else e.remove()}};var Te={state:{article:{title:"",html:""}},mutations:{setArticle:({article:t},{title:e,html:i})=>{t.title=e,t.html=i},setArticleMedia:({article:t},{media:e})=>{t.media=e}},actions:{fetchArticle:async({commit:t},e)=>{const i=`https://${ge}.wikipedia.org/api/rest_v1/page/mobile-html/${e}`,s=await(await fetch(i)).text(),a=(new DOMParser).parseFromString(s,"text/html");Object.values($e).forEach(t=>t(a)),t("setArticle",{title:e,html:a.body.outerHTML})},fetchArticleMedia:({commit:t},e)=>{const i=`https://${ge}.wikipedia.org/api/rest_v1/page/media-list/${encodeURIComponent(e)}`;Se(i,e=>{const i=e.items.reduce((t,e)=>e.showInGallery&&"image"===e.type?t.concat(e):t,[]);i&&t("setArticleMedia",{media:i})})}},getters:{currentArticle:({article:t})=>t}};s["a"].use(C["a"]);var Le=new C["a"].Store({modules:{story:we,search:Ie,article:Te,commons:Fe}});s["a"].directive("focus",{inserted:function(t){t.focus()}}),s["a"].filter("formatDate",(function(t){if(t)return new Date(t).toLocaleString()}));var Oe=i("5093"),Ae=i.n(Oe),je={welcome:"Welcome to Wikistories","btn-create":"Create a story","btn-restart-story":"Start again","search-box":"Search Wikipedia","search-media":"Search Media","search-media-info":"$1 selected","wikimedia-commons":"Commons",wikipedia:"Wikipedia","btn-publish-wikistory":"Publish Wikistory","btn-highlight":"Highlight","btn-clear":"Clear","btn-select-image":"Select an image","btn-next":"Next","publish-date":"Date","publish-tags":"Tags","publish-language":"Language","tags-not-set":"Not set yet","unknown-author":"Author unknown"},Pe={welcome:"Bienvenue sur les Wikistoires","btn-create":"Creer une histoire","btn-restart-story":"Recommencer","search-box":"Recherche dans Wikipédia","search-media":"Recherche de Média","search-media-info":"$1 {{PLURAL:$1|selectionné|selectionnés}}","wikimedia-commons":"Commons",wikipedia:"Wikipédia","btn-publish-wikistory":"Publier la Wikistoire","btn-highlight":"Surligner","btn-clear":"Annuler","btn-select-image":"Selectionnez une image","btn-next":"Suivant","publish-date":"Date","publish-tags":"Mots clés","publish-language":"Langue","tags-not-set":"Non definies"},De={welcome:"Welcome to Wikistories","btn-create":"Buat cerita","btn-restart-story":"mulai dari awal","search-box":"Cari di wikipedia","search-media":"Cari media","search-media-info":"$1 dipilih","wikimedia-commons":"Commons",wikipedia:"Wikipedia","btn-publish-wikistory":"Publikasikan Wikistory","btn-highlight":"Sorot teks","btn-clear":"Hapus pilihan","btn-select-image":"Pilih gambar","btn-next":"Lanjut","publish-date":"Tanggal","publish-tags":"Tags","publish-language":"Bahasa","tags-not-set":"Belum disetel"},Ee={welcome:"歡迎光臨 Wikistories","btn-create":"創建故事","btn-restart-story":"重新開始","search-box":"搜尋維基百科","search-media":"搜尋媒體","search-media-info":"$1 選擇","wikimedia-commons":"維基共享資源",wikipedia:"維基百科","btn-publish-wikistory":"發佈 Wikistory","btn-highlight":"Highlight","btn-clear":"移除","btn-select-image":"選擇圖片","btn-next":"下一步","publish-date":"日期","publish-tags":"標簽","publish-language":"語言","tags-not-set":"尚未設定"},qe={welcome:"Bienvenido a Wikistories","btn-create":"Crea una historia","btn-restart-story":"Empezar de nuevo","search-box":"Buscar en Wikipedia","search-media":"Buscar en Commons","search-media-info":"$1 seleccionado","wikimedia-commons":"Commons",wikipedia:"Wikipedia","btn-publish-wikistory":"Publica tu Wikistory","btn-highlight":"Resaltar","btn-clear":"Cancelar","btn-select-image":"Selecciona una imagen","btn-next":"Sigue","publish-date":"Fecha","publish-tags":"Etiquetas","publish-language":"Idioma","tags-not-set":"Todavia no disponible"},We={welcome:"Bemvindo a Wikistories","btn-create":"Crie uma historia","btn-restart-story":"Começar de novo","search-box":"Pesquisar Wikipedia","search-media":"Pesquisar Commons","search-media-info":"$1 selecionado","wikimedia-commons":"Commons",wikipedia:"Wikipedia","btn-publish-wikistory":"Poste a sua Wikistory","btn-highlight":"Realçar","btn-clear":"Cancerlar","btn-select-image":"Selecione uma imagem","btn-next":"Segue","publish-date":"Data","publish-tags":"Etiquetas","publish-language":"Idioma","tags-not-set":"Não disponivel ainda"};s["a"].use(Ae.a,{locale:be,messages:{en:je,fr:Pe,id:De,zh:Ee,es:qe,pt:We}}),s["a"].config.productionTip=!1,new s["a"]({router:fe,store:Le,render:t=>t(u)}).$mount("#app")},5801:function(t,e,i){},"5ced":function(t,e,i){},"62fb":function(t,e,i){"use strict";i("aa55")},6675:function(t,e,i){"use strict";i("023c")},"703d":function(t,e,i){},7089:function(t,e,i){"use strict";i("09e0")},"7be0":function(t,e,i){},"85ec":function(t,e,i){},8637:function(t,e,i){"use strict";i("5801")},"884e":function(t,e,i){"use strict";i("ba7b")},8855:function(t,e,i){},9131:function(t,e,i){"use strict";i("2f7e")},"9c37":function(t,e,i){"use strict";i("f31b")},a048:function(t,e,i){},a2f2:function(t,e,i){"use strict";i("b1f0")},a51b:function(t,e,i){"use strict";i("8855")},a8b7:function(t,e,i){},aa55:function(t,e,i){},b1f0:function(t,e,i){},b78b:function(t,e,i){"use strict";i("a048")},ba7b:function(t,e,i){},c452:function(t,e,i){"use strict";i("a8b7")},cccb:function(t,e,i){"use strict";i("5ced")},d79a:function(t,e,i){"use strict";i("1271")},e15c:function(t,e,i){"use strict";i("3a9f")},ef9e:function(t,e,i){},f207:function(t,e,i){"use strict";i("7be0")},f31b:function(t,e,i){}});
//# sourceMappingURL=app.4393ca62.js.map